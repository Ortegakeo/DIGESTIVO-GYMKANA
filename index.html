<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Modelo 3B Interactivo – Aparato Digestivo (UCM Bioingeniería Médica)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      text-align: center;
    }
    h1 {
      background: #004c91;
      color: white;
      padding: 15px;
      margin: 0;
    }
    #menu {
      background: #0078D7;
      padding: 10px;
    }
    #menu button {
      background: white;
      color: #0078D7;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      margin: 5px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    #menu button.active {
      background: #005a9e;
      color: white;
    }
    #controls {
      margin: 15px 0;
    }
    button {
      background: #0078D7;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 6px;
      font-size: 16px;
      margin: 5px;
      cursor: pointer;
    }
    button:hover { background: #005a9e; }
    #container {
      position: relative;
      display: inline-block;
      max-width: 90%;
    }
    img {
      width: 100%;
      height: auto;
      border-radius: 10px;
      border: 3px solid #ccc;
      background: white;
    }
    .hotspot {
      position: absolute;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: rgba(255,0,0,0.8);
      color: white;
      font-weight: bold;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: grab;
      user-select: none;
    }
    .hidden {
      background: transparent !important;
      color: transparent !important;
      border: none !important;
      cursor: pointer;
    }
    #infoBox {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: white;
      border: 2px solid #0078D7;
      border-radius: 10px;
      padding: 10px;
      width: 320px;
      font-weight: bold;
      color: #004c91;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <h1>Modelo 3B Interactivo – Aparato Digestivo (UCM Bioingeniería Médica)</h1>

  <div id="menu">
    <button class="active" data-plana="estomago">Hígado y Estómago</button>
    <button data-plana="ABDOMEN">Intestino entero</button>
    <button data-plana="INTESTINOS">Intestino delgado y grueso</button>
  </div>

  <div id="controls">
    <button id="modoBtn">Cambiar a Modo Práctica</button>
    <button id="editBtn">Cambiar a Modo Edición</button>
  </div>

  <div id="container">
    <img id="planaImg" src="estomago.jpg" alt="Plana 1 – Hígado y Estómago">
  </div>

  <div id="infoBox">Modo Consulta: haz clic en un número para ver la estructura.</div>

  <script>
    let modo = "consulta";
    let edicion = true;
    let planaActual = "estomago";

    const estructuras = {
      "estomago": {
        1:"Hígado", 2:"Hígado, área desnuda", 3:"Hígado, cara diafragmática",
        4:"Hígado, cara visceral", 5:"Hígado, impresión del colon",
        6:"Hígado, impresión del duodeno", 7:"Hígado, impresión del estómago",
        8:"Hígado, impresión del esófago", 9:"Hígado, impresión del riñón",
        10:"Hígado, lóbulo caudado", 11:"Hígado, lóbulo derecho",
        12:"Hígado, lóbulo cuadrado", 13:"Hígado, lóbulo izquierdo",
        14:"Hígado, borde inferior", 15:"Hígado, proceso caudado",
        16:"A. hepática común", 17:"Conducto hepático derecho",
        18:"Conducto hepático izquierdo", 19:"V. cava inferior",
        20:"Vv. hepáticas", 21:"Lig. redondo del hígado",
        22:"Lig. falciforme", 23:"Vesícula biliar, cuello",
        24:"Vesícula biliar, cuerpo", 25:"Vesícula biliar, fondo",
        26:"Conducto cístico", 27:"Conducto colédoco",
        28:"V. porta hepática",
        a:"A. gástrica derecha", b:"Píloro"
      },
      "ABDOMEN": {
        1:"Colon ascendente", 2:"Colon descendente", 3:"Colon sigmoide",
        4:"Colon transverso", 5:"Colon, haustra", 6:"Colon, plica semilunar",
        7:"Válvula del orificio ileocecal", 8:"Íleon", 9:"Yeyuno",
        10:"Apéndice vermiforme", 11:"Apéndice vermiforme, orificio",
        12:"Omento mayor", 13:"Válvula ileocecal", 14:"Tenia libre",
        15:"Ángulo derecho del colon", 16:"Ángulo izquierdo del colon",
        17:"Recto, ángulo sacro", 18:"Peritoneo visceral", 19:"Duodeno, ángulo inferior",
        20:"Duodeno, ángulo superior", 21:"Duodeno, porción ascendente",
        22:"Duodeno, porción descendente", 23:"Duodeno, porción horizontal",
        24:"Páncreas, cabeza", 25:"Páncreas, cola", 26:"Páncreas, cuerpo",
        27:"Conducto colédoco", 28:"A. y v. esplénicas", 29:"Conducto pancreático",
        30:"Ciego"
      },
      "INTESTINOS": {
        1:"Conducto pancreático", 2:"Colon ascendente", 3:"Colon descendente",
        4:"Colon sigmoide", 5:"Colon transverso", 6:"Colon, haustra",
        7:"Válvula del orificio ileocecal", 8:"Válvula ileocecal", 9:"Páncreas, cabeza",
        10:"Páncreas, cola", 11:"Páncreas, cuerpo", 12:"Páncreas",
        13:"Duodeno", 14:"Duodeno, ángulo inferior", 15:"Duodeno, ángulo superior",
        16:"Duodeno, porción ascendente", 17:"Duodeno, porción descendente",
        18:"Conducto colédoco", 19:"A. y v. esplénicas", 20:"Apéndice vermiforme",
        21:"Apéndice vermiforme, orificio", 22:"Ciego", 23:"Tenia libre",
        24:"Íleon", 25:"Yeyuno", 26:"Conducto pancreático accesorio (Santorini)",
        27:"A. y v. mesentéricas superiores", 28:"A. y V. mesentérica inferior",
        29:"Aa. y Vv. yeyunales e ileales", 30:"A. y V. cólica derecha",
        31:"A. y V. cólica media", 32:"A. y V. cólica izquierda",
        33:"Aa. y Vv. sigmoideas", 34:"A. rectal superior", 35:"Mesocolon transverso"
      }
    };

    const container = document.getElementById("container");
    const infoBox = document.getElementById("infoBox");

    // Generar puntos iniciales
    function generarHotspots() {
      container.querySelectorAll(".hotspot").forEach(e => e.remove());
      const lista = estructuras[planaActual];
      for (let n in lista) {
        const hs = document.createElement("div");
        hs.className = "hotspot";
        hs.dataset.numero = n;
        hs.textContent = n;
        hs.style.top = Math.random() * 90 + "%";
        hs.style.left = Math.random() * 90 + "%";
        if (!edicion) hs.classList.add("hidden");
        hs.addEventListener("click", () => {
          if (edicion) return;
          const nombre = lista[n] || "No asignado";
          if (modo === "consulta") {
            infoBox.innerText = `${n}: ${nombre}`;
          } else {
            const r = prompt(`Introduce el nombre para el número ${n}:`);
            if (r) {
              if (normalizar(r) === normalizar(nombre))
                alert(`✅ Correcto: ${nombre}`);
              else alert(`❌ Incorrecto. Correcto: ${nombre}`);
            }
          }
        });
        hs.addEventListener("mousedown", e => {
          if (!edicion) return;
          const rect = container.getBoundingClientRect();
          function move(ev) {
            const x = (ev.clientX - rect.left) / rect.width * 100;
            const y = (ev.clientY - rect.top) / rect.height * 100;
            hs.style.left = x + "%";
            hs.style.top = y + "%";
          }
          function up() {
            document.removeEventListener("mousemove", move);
            document.removeEventListener("mouseup", up);
          }
          document.addEventListener("mousemove", move);
          document.addEventListener("mouseup", up);
        });
        container.appendChild(hs);
      }
    }

    // Normalizar texto
    function normalizar(txt) {
      return txt.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").replace(/[\.,;:]/g, "");
    }

    // Cambiar modo
    document.getElementById("modoBtn").onclick = () => {
      modo = (modo === "consulta") ? "practica" : "consulta";
      infoBox.innerText = (modo === "consulta")
        ? "Modo Consulta: haz clic en un número para ver la estructura."
        : "Modo Práctica: haz clic en un número e ingresa la respuesta.";
    };

    // Cambiar edición
    document.getElementById("editBtn").onclick = () => {
      edicion = !edicion;
      document.querySelectorAll(".hotspot").forEach(h => {
        if (edicion) h.classList.remove("hidden");
        else h.classList.add("hidden");
      });
    };

    // Cambiar plana
    document.querySelectorAll("#menu button").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll("#menu button").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        planaActual = btn.dataset.plana;
        document.getElementById("planaImg").src = planaActual + ".jpg";
        generarHotspots();
      });
    });

    generarHotspots();
  </script>
</body>
</html>
