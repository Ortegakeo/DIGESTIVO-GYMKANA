<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Modelo 3B Interactivo ‚Äì Aparato Digestivo (UCM Bioingenier√≠a M√©dica)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 0;
      text-align: center;
    }
    h1 {
      background: #004c91;
      color: white;
      padding: 15px;
      margin: 0;
    }
    #menu {
      background: #0078D7;
      padding: 10px;
    }
    #menu button {
      background: white;
      color: #0078D7;
      border: none;
      padding: 10px 20px;
      font-size: 16px;
      margin: 5px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }
    #menu button.active {
      background: #005a9e;
      color: white;
    }
    #controls {
      margin: 15px 0;
    }
    button {
      background: #0078D7;
      color: white;
      border: none;
      padding: 10px 18px;
      border-radius: 6px;
      font-size: 16px;
      margin: 5px;
      cursor: pointer;
    }
    button:hover { background: #005a9e; }
    #container {
      position: relative;
      display: inline-block;
      max-width: 90%;
    }
    img {
      width: 100%;
      height: auto;
      border-radius: 10px;
      border: 3px solid #ccc;
      background: white;
    }
    .hotspot {
      position: absolute;
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: rgba(255,0,0,0.8);
      color: white;
      font-weight: bold;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: grab;
      user-select: none;
    }
    .hidden {
      background: transparent !important;
      color: transparent !important;
      border: none !important;
      cursor: pointer;
    }
    #infoBox {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: white;
      border: 2px solid #0078D7;
      border-radius: 10px;
      padding: 10px;
      width: 320px;
      font-weight: bold;
      color: #004c91;
      z-index: 1000;
    }
  </style>
</head>
<body>
  <h1>Modelo 3B Interactivo ‚Äì Aparato Digestivo (UCM Bioingenier√≠a M√©dica)</h1>

  <div id="menu">
    <button class="active" data-plana="estomago">H√≠gado y Est√≥mago</button>
    <button data-plana="ABDOMEN">Intestino entero</button>
    <button data-plana="INTESTINOS">Intestino delgado y grueso</button>
  </div>

  <div id="controls">
    <button id="modoBtn">Cambiar a Modo Pr√°ctica</button>
    <button id="editBtn">Cambiar a Modo Edici√≥n</button>
    <button id="exportBtn">üíæ Exportar coordenadas</button>
  </div>

  <div id="container">
    <img id="planaImg" src="estomago.jpg" alt="Plana 1 ‚Äì H√≠gado y Est√≥mago">
  </div>

  <div id="infoBox">Modo Consulta: haz clic en un n√∫mero para ver la estructura.</div>

  <script>
    let modo = "consulta";
    let edicion = false; // Inicia oculto
    let planaActual = "estomago";

    const estructuras = {
      "estomago": {
        1:"H√≠gado",2:"H√≠gado, √°rea desnuda",3:"H√≠gado, cara diafragm√°tica",4:"H√≠gado, cara visceral",
        5:"H√≠gado, impresi√≥n del colon",6:"H√≠gado, impresi√≥n del duodeno",7:"H√≠gado, impresi√≥n del est√≥mago",
        8:"H√≠gado, impresi√≥n del es√≥fago",9:"H√≠gado, impresi√≥n del ri√±√≥n",10:"H√≠gado, l√≥bulo caudado",
        11:"H√≠gado, l√≥bulo derecho",12:"H√≠gado, l√≥bulo cuadrado",13:"H√≠gado, l√≥bulo izquierdo",
        14:"H√≠gado, borde inferior",15:"H√≠gado, proceso caudado",16:"A. hep√°tica com√∫n",17:"Conducto hep√°tico derecho",
        18:"Conducto hep√°tico izquierdo",19:"V. cava inferior",20:"Vv. hep√°ticas",21:"Lig. redondo del h√≠gado",
        22:"Lig. falciforme",23:"Ves√≠cula biliar, cuello",24:"Ves√≠cula biliar, cuerpo",25:"Ves√≠cula biliar, fondo",
        26:"Conducto c√≠stico",27:"Conducto col√©doco",28:"V. porta hep√°tica"
      },
      "ABDOMEN": {
        1:"Colon ascendente",2:"Colon descendente",3:"Colon sigmoide",4:"Colon transverso",5:"Colon, haustra",
        6:"Colon, plica semilunar",7:"V√°lvula del orificio ileocecal",8:"√çleon",9:"Yeyuno",10:"Ap√©ndice vermiforme",
        11:"Ap√©ndice vermiforme, orificio",12:"Omento mayor",13:"V√°lvula ileocecal",14:"Tenia libre",
        15:"√Ångulo derecho del colon",16:"√Ångulo izquierdo del colon",17:"Recto, √°ngulo sacro",18:"Peritoneo visceral",
        19:"Duodeno, √°ngulo inferior",20:"Duodeno, √°ngulo superior",21:"Duodeno, porci√≥n ascendente",
        22:"Duodeno, porci√≥n descendente",23:"Duodeno, porci√≥n horizontal",24:"P√°ncreas, cabeza",
        25:"P√°ncreas, cola",26:"P√°ncreas, cuerpo",27:"Conducto col√©doco",28:"A. y v. espl√©nicas",
        29:"Conducto pancre√°tico",30:"Ciego"
      },
      "INTESTINOS": {
        1:"Conducto pancre√°tico",2:"Colon ascendente",3:"Colon descendente",4:"Colon sigmoide",5:"Colon transverso",
        6:"Colon, haustra",7:"V√°lvula del orificio ileocecal",8:"V√°lvula ileocecal",9:"P√°ncreas, cabeza",
        10:"P√°ncreas, cola",11:"P√°ncreas, cuerpo",12:"P√°ncreas",13:"Duodeno",14:"Duodeno, √°ngulo inferior",
        15:"Duodeno, √°ngulo superior",16:"Duodeno, porci√≥n ascendente",17:"Duodeno, porci√≥n descendente",
        18:"Conducto col√©doco",19:"A. y v. espl√©nicas",20:"Ap√©ndice vermiforme",21:"Ap√©ndice vermiforme, orificio",
        22:"Ciego",23:"Tenia libre",24:"√çleon",25:"Yeyuno",26:"Conducto pancre√°tico accesorio (Santorini)",
        27:"A. y v. mesent√©ricas superiores",28:"A. y V. mesent√©rica inferior",29:"Aa. y Vv. yeyunales e ileales",
        30:"A. y V. c√≥lica derecha",31:"A. y V. c√≥lica media",32:"A. y V. c√≥lica izquierda",
        33:"Aa. y Vv. sigmoideas",34:"A. rectal superior",35:"Mesocolon transverso"
      }
    };

    const coordenadasIntegradas = { "INTESTINOS": {"hotspot_1":{"top":"18.4408%","left":"69.1442%"} } };

    // Cargar coordenadas
    let coordenadasGuardadas = JSON.parse(localStorage.getItem("coordenadas_por_plana")) || coordenadasIntegradas;

    const container = document.getElementById("container");
    const infoBox = document.getElementById("infoBox");

    function generarHotspots() {
      container.querySelectorAll(".hotspot").forEach(e => e.remove());
      const lista = estructuras[planaActual];
      const coords = coordenadasGuardadas[planaActual] || {};
      for (let n in lista) {
        const hs = document.createElement("div");
        hs.className = "hotspot hidden";
        hs.dataset.numero = n;
        hs.textContent = n;
        hs.style.top = coords[`hotspot_${n}`]?.top || Math.random() * 90 + "%";
        hs.style.left = coords[`hotspot_${n}`]?.left || Math.random() * 90 + "%";
        hs.addEventListener("click", () => {
          if (edicion) return;
          const nombre = lista[n] || "No asignado";
          if (modo === "consulta") infoBox.innerText = `${n}: ${nombre}`;
          else {
            const r = prompt(`Introduce el nombre para el n√∫mero ${n}:`);
            if (r) alert(normalizar(r) === normalizar(nombre) ? `‚úÖ Correcto: ${nombre}` : `‚ùå Incorrecto. Correcto: ${nombre}`);
          }
        });
        container.appendChild(hs);
      }
    }

    function normalizar(txt) {
      return txt.toLowerCase().normalize("NFD").replace(/[ÃÄ-ÕØ]/g, "").replace(/[\.,;:]/g, "");
    }

    document.getElementById("modoBtn").onclick = () => {
      modo = (modo === "consulta") ? "practica" : "consulta";
      infoBox.innerText = (modo === "consulta")
        ? "Modo Consulta: haz clic en un n√∫mero para ver la estructura."
        : "Modo Pr√°ctica: haz clic en un n√∫mero e ingresa la respuesta.";
    };

    document.getElementById("editBtn").onclick = () => {
      edicion = !edicion;
      document.querySelectorAll(".hotspot").forEach(h => h.classList.toggle("hidden", !edicion));
    };

    document.querySelectorAll("#menu button").forEach(btn => {
      btn.addEventListener("click", () => {
        document.querySelectorAll("#menu button").forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
        planaActual = btn.dataset.plana;
        document.getElementById("planaImg").src = planaActual + ".jpg";
        generarHotspots();
      });
    });

    document.getElementById("exportBtn").onclick = () => {
      const blob = new Blob([JSON.stringify(coordenadasGuardadas, null, 2)], {type: "application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "coordenadas_actualizadas.json";
      a.click();
      URL.revokeObjectURL(a.href);
    };

    generarHotspots();
  </script>
</body>
</html>
